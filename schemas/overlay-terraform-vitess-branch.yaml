overlay: 1.0.0
x-speakeasy-jsonpath: rfc9535
info:
  title: Terraform generation overlay for planetscale_branch_vitess managed and data resources.
  version: 0.0.1
actions:
  - target: $.paths
    description: Add VitessBranch path entries
    update:
      /organizations/{organization}/databases/{database}/branches#vitess: {}
      /organizations/{organization}/databases/{database}/branches/{branch}#vitess: {}

  - target: $.paths['/organizations/{organization}/databases/{database}/branches#vitess'].post
    description: Copy create_branch operation as base
    copy: $.paths['/organizations/{organization}/databases/{database}/branches'].post

  - target: $.paths['/organizations/{organization}/databases/{database}/branches#vitess'].post
    description: Update operation metadata for Vitess
    update:
      operationId: create_vitess_branch
      summary: Create a Vitess branch
      x-speakeasy-entity-operation: VitessBranch#create
      x-speakeasy-entity-description: Manage a PlanetScale Vitess database branch.

  - target: $.paths['/organizations/{organization}/databases/{database}/branches#vitess'].post.requestBody.content['application/json'].schema.properties.restore_point
    description: Remove restore_point (Postgres-only field)
    remove: true
  - target: $.paths['/organizations/{organization}/databases/{database}/branches#vitess'].post.requestBody.content['application/json'].schema.properties.major_version
    description: Remove major_version (Postgres-only field)
    remove: true

  # Remove required fields that don't apply to Vitess
  - target: $.paths['/organizations/{organization}/databases/{database}/branches#vitess'].post.responses['201'].content['application/json'].schema.required
    remove: true

  # Update kind to be const: mysql instead of enum
  - target: $.paths['/organizations/{organization}/databases/{database}/branches#vitess'].post.responses['201'].content['application/json'].schema.properties.kind
    description: Set kind to const mysql
    update:
      const: mysql
      description: The kind of branch (always mysql for Vitess branches)
  - target: $.paths['/organizations/{organization}/databases/{database}/branches#vitess'].post.responses['201'].content['application/json'].schema.properties.kind.enum
    remove: true

  - target: $.paths['/organizations/{organization}/databases/{database}/branches#vitess'].post.responses['201'].content['application/json'].schema.properties
    description: Add Vitess-specific response fields
    update:
      mysql_provider_address:
        type: string
        description: The MySQL provider address for the branch
      cluster_rate_name:
        type: string
        description: The rate name for the cluster
      private_connectivity:
        type: boolean
        description: True if private connectivity is enabled

  - target: $.paths['/organizations/{organization}/databases/{database}/branches#vitess'].post.responses['201'].content['application/json'].schema.properties.region
    description: Add region_data name override
    update:
      x-speakeasy-name-override: region_data

  - target: $.paths['/organizations/{organization}/databases/{database}/branches/{branch}#vitess'].get
    description: Copy get_branch operation as base
    copy: $.paths['/organizations/{organization}/databases/{database}/branches/{branch}'].get

  - target: $.paths['/organizations/{organization}/databases/{database}/branches/{branch}#vitess'].get
    description: Update operation metadata for Vitess
    update:
      operationId: get_vitess_branch
      summary: Get a Vitess branch
      x-speakeasy-entity-operation:
        - VitessBranch#read
        - entityOperation: VitessBranch#create#2
          options:
            polling:
              name: WaitForReady
      x-speakeasy-entity-description: Returns information about a PlanetScale Vitess database branch.
      x-speakeasy-polling:
        - name: WaitForReady
          limitCount: 300
          successCriteria:
            - condition: $statusCode == 200
            - condition: $response.body#/state == "ready"

  - target: $.paths['/organizations/{organization}/databases/{database}/branches/{branch}#vitess'].get.parameters[?@.name == 'branch']
    description: Add x-speakeasy-match to branch parameter
    update:
      x-speakeasy-match: id

  - target: $.paths['/organizations/{organization}/databases/{database}/branches/{branch}#vitess'].get.responses['200'].content['application/json'].schema.required
    remove: true

  - target: $.paths['/organizations/{organization}/databases/{database}/branches/{branch}#vitess'].get.responses['200'].content['application/json'].schema.properties.kind
    description: Set kind to const mysql
    update:
      const: mysql
      description: The kind of branch (always mysql for Vitess branches)
  - target: $.paths['/organizations/{organization}/databases/{database}/branches/{branch}#vitess'].get.responses['200'].content['application/json'].schema.properties.kind.enum
    remove: true

  - target: $.paths['/organizations/{organization}/databases/{database}/branches/{branch}#vitess'].get.responses['200'].content['application/json'].schema.properties
    description: Add Vitess-specific response fields
    update:
      mysql_provider_address:
        type: string
        description: The MySQL provider address for the branch
      cluster_rate_name:
        type: string
        description: The rate name for the cluster
      private_connectivity:
        type: boolean
        description: True if private connectivity is enabled

  - target: $.paths['/organizations/{organization}/databases/{database}/branches/{branch}#vitess'].get.responses['200'].content['application/json'].schema.properties.region
    description: Add region_data name override
    update:
      x-speakeasy-name-override: region_data

  - target: $.paths['/organizations/{organization}/databases/{database}/branches/{branch}#vitess'].delete
    description: Copy delete_branch operation as base
    copy: $.paths['/organizations/{organization}/databases/{database}/branches/{branch}'].delete

  - target: $.paths['/organizations/{organization}/databases/{database}/branches/{branch}#vitess'].delete
    description: Update operation metadata for Vitess
    update:
      operationId: delete_vitess_branch
      summary: Delete a Vitess branch
      x-speakeasy-entity-operation: VitessBranch#delete

  - target: $.paths['/organizations/{organization}/databases/{database}/branches/{branch}#vitess'].delete.parameters[?@.name == 'branch']
    description: Add x-speakeasy-match to branch parameter
    update:
      x-speakeasy-match: id
