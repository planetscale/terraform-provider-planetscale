overlay: 1.1.0
x-speakeasy-jsonpath: rfc9535
info:
  title: Terraform generation overlay for planetscale_database_postgres managed and data resources.
  version: 0.0.1
actions:
  - target: $.paths
    update:
      /organizations/{organization}/databases#postgres: {}

  - target: $.paths['/organizations/{organization}/databases#postgres']
    description: Copy databases path as base
    copy: $.paths['/organizations/{organization}/databases']

  - target: $.paths
    update:
      /organizations/{organization}/databases/{database}#postgres: {}

  - target: $.paths['/organizations/{organization}/databases/{database}#postgres']
    description: Copy database path as base
    copy: $.paths['/organizations/{organization}/databases/{database}']

  - target: $.paths['/organizations/{organization}/databases#postgres'].get
    remove: true

  - target: $.paths['/organizations/{organization}/databases#postgres'].post
    update:
      operationId: create_postgres_database
      summary: Create a PostgreSQL database
      # x-speakeasy-entity-operation: DatabasePostgres#create
      x-speakeasy-entity-description: Manage a PlanetScale PostgreSQL database.

  - target: $.paths['/organizations/{organization}/databases#postgres'].post.requestBody.content['application/json'].schema.properties
    update:
      kind:
        type: string
        const: postgresql
        default: postgresql
        description: The kind of database (always postgresql for PostgreSQL databases).
      major_version:
        type: string
        description: The PostgreSQL major version to use for the database. Defaults to the latest available major version.

  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.kind
    update:
      const: postgresql
      description: The kind of database
  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.kind.enum
    remove: true

  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.region
    update:
      x-speakeasy-name-override: region_data
  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.branches_count
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.open_schema_recommendations_count
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.development_branches_count
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.production_branches_count
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.issues_count
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.default_branch_shard_count
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.default_branch_read_only_regions_count
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.default_branch_table_count
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.default_branch
    update:
      x-speakeasy-terraform-ignore: true

  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.sharded
    remove: true
  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.allow_data_branching
    remove: true
  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.foreign_keys_enabled
    remove: true
  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.automatic_migrations
    remove: true
  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.migration_table_name
    remove: true
  - target: $.paths['/organizations/{organization}/databases#postgres'].post.responses['201'].content['application/json'].schema.properties.migration_framework
    remove: true

  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].get
    update:
      operationId: get_postgres_database
      summary: Get a PostgreSQL database
      x-speakeasy-entity-operation:
        - DatabasePostgres#read
          #   - entityOperation: DatabasePostgres#create#2
          #     options:
          #       polling:
          #         name: WaitForReady
      x-speakeasy-entity-description: Returns information about a PlanetScale PostgreSQL database.
      x-speakeasy-polling:
        - name: WaitForReady
          limitCount: 300
          successCriteria:
            - condition: $statusCode == 200
            - condition: $response.body#/state == "ready"

  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].get.parameters[?@.name == 'database']
    update:
      x-speakeasy-match: id

  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].get.responses['200'].content['application/json'].schema.properties.kind
    update:
      const: postgresql
      description: The kind of database
  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].get.responses['200'].content['application/json'].schema.properties.kind.enum
    remove: true

  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].get.responses['200'].content['application/json'].schema.properties.region
    update:
      x-speakeasy-name-override: region_data

  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].get.responses['200'].content['application/json'].schema.properties.sharded
    remove: true
  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].get.responses['200'].content['application/json'].schema.properties.allow_data_branching
    remove: true
  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].get.responses['200'].content['application/json'].schema.properties.foreign_keys_enabled
    remove: true
  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].get.responses['200'].content['application/json'].schema.properties.automatic_migrations
    remove: true
  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].get.responses['200'].content['application/json'].schema.properties.migration_table_name
    remove: true
  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].get.responses['200'].content['application/json'].schema.properties.migration_framework
    remove: true

  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].patch
    update:
      operationId: update_postgres_database
      summary: Update PostgreSQL database settings
      # x-speakeasy-entity-operation: DatabasePostgres#update

  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].patch.parameters[?@.name == 'database']
    update:
      x-speakeasy-match: id

  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].patch.requestBody.content['application/json'].schema.properties.automatic_migrations
    remove: true
  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].patch.requestBody.content['application/json'].schema.properties.migration_framework
    remove: true
  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].patch.requestBody.content['application/json'].schema.properties.migration_table_name
    remove: true
  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].patch.requestBody.content['application/json'].schema.properties.allow_data_branching
    remove: true
  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].patch.requestBody.content['application/json'].schema.properties.allow_foreign_key_constraints
    remove: true

  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].patch.requestBody.content['application/json'].schema.properties.default_branch
    update:
      x-speakeasy-terraform-ignore: true

  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].delete
    update:
      operationId: delete_postgres_database
      summary: Delete a PostgreSQL database
      # x-speakeasy-entity-operation: DatabasePostgres#delete

  - target: $.paths['/organizations/{organization}/databases/{database}#postgres'].delete.parameters[?@.name == 'database']
    update:
      x-speakeasy-match: id
